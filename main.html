<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better Instagram</title>
    <style>
        /* Support both ID formats for testing */
        #div1, [data-testid="drag1"] {
            background-image: url("https://picsum.photos/id/237/200/300");
        }
        #div2, [data-testid="drag2"] {
            background-image: url("https://picsum.photos/seed/picsum/200/300");
        }
        #div3, [data-testid="drag3"] {
            background-image: url("https://picsum.photos/200/300?grayscale");
        }
        #div4, [data-testid="drag4"] {
            background-image: url("https://picsum.photos/200/300/");
        }
        #div5, [data-testid="drag5"] {
            background-image: url("https://picsum.photos/200/300.jpg");
        }
        #div6, [data-testid="drag6"] {
            background-image: url("https://picsum.photos/id/102/200/300");
        }

        .image {
            height: 300px;
            width: 200px;
            margin: 20px;
            cursor: move;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background-size: cover;
            background-position: center;
            transition: all 0.3s ease;
            user-select: none;
        }

        .flex {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            min-height: 100vh;
        }

        .dragging {
            opacity: 0.5;
            border: 3px dashed white;
        }

        .drop-target {
            border: 3px solid #00c3ff;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <h1>Arrange Images by drag and drop</h1>
    <div class="flex" id="parent">
        <!-- Elements with both regular IDs and test IDs -->
        <div draggable="true" class="image" id="div1" data-testid="drag1">Image 1</div>
        <div draggable="true" class="image" id="div2" data-testid="drag2">Image 2</div>
        <div draggable="true" class="image" id="div3" data-testid="drag3">Image 3</div>
        <div draggable="true" class="image" id="div4" data-testid="drag4">Image 4</div>
        <div draggable="true" class="image" id="div5" data-testid="drag5">Image 5</div>
        <div draggable="true" class="image" id="div6" data-testid="drag6">Image 6</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const parent = document.getElementById('parent');
            const images = parent.querySelectorAll('.image');
            
            // Initialize drag and drop
            images.forEach(img => {
                img.addEventListener('dragstart', handleDragStart);
                img.addEventListener('dragover', handleDragOver);
                img.addEventListener('dragenter', handleDragEnter);
                img.addEventListener('dragleave', handleDragLeave);
                img.addEventListener('drop', handleDrop);
                img.addEventListener('dragend', handleDragEnd);
            });

            let draggedItem = null;

            function handleDragStart(e) {
                draggedItem = this;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', this.dataset.testid);
                this.classList.add('dragging');
                setTimeout(() => this.style.visibility = 'hidden', 0);
            }

            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            }

            function handleDragEnter(e) {
                e.preventDefault();
                if (this !== draggedItem) {
                    this.classList.add('drop-target');
                }
            }

            function handleDragLeave() {
                this.classList.remove('drop-target');
            }

            function handleDrop(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (draggedItem !== this) {
                    // Get current positions
                    const draggedIndex = Array.from(images).indexOf(draggedItem);
                    const dropIndex = Array.from(images).indexOf(this);
                    
                    // Swap positions
                    if (draggedIndex < dropIndex) {
                        parent.insertBefore(this, draggedItem);
                    } else {
                        parent.insertBefore(draggedItem, this.nextSibling);
                    }
                }
                
                this.classList.remove('drop-target');
            }

            function handleDragEnd() {
                this.classList.remove('dragging');
                this.style.visibility = 'visible';
                images.forEach(img => img.classList.remove('drop-target'));
            }

            // Make functions available for testing
            window.dragAndDrop = {
                handleDragStart,
                handleDragEnd,
                handleDrop
            };
        });
    </script>
</body>
</html>